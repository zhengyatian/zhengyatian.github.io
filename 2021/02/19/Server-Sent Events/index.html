<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    Server-Sent Events / EventSource |
    
    è¿·</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
<main class="content">
  <section class="outer">
  <article id="post-Server-Sent Events" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

    <div class="article-inner">
        
            <header class="article-header">
                
  
    <h1 class="article-title" itemprop="name">
      Server-Sent Events / EventSource
    </h1>
  
  




            </header>
            

                
                    <div class="article-meta">
                        <a href="/2021/02/19/Server-Sent%20Events/" class="article-date">
  <time datetime="2021-02-19T09:26:12.000Z" itemprop="datePublished">2021-02-19</time>
</a>
                            
                    </div>
                    

                        
                            
    <div class="tocbot"></div>





                                

                                    <div class="article-entry" itemprop="articleBody">
                                        


                                            

                                                
                                                                    <h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>â€‹    å…¬å¸çš„ OA é¡¹ç›®ä¸­ï¼Œå¾€å¾€éœ€è¦æ¥å…¥å¾ˆå¤šä¸šåŠ¡ç³»ç»Ÿï¼Œä½“ç°åœ¨ App UI ä¸Šå°±ç±»ä¼¼æ”¯ä»˜å®é¦–é¡µçš„ä¹å®«æ ¼ã€‚è¿™äº›ä¸šåŠ¡ç³»ç»Ÿå‘¢åˆä¸ä¸€å®šæ¥è‡ªåŒä¸€å®¶å‚å•†ï¼Œå½“ App éœ€è¦å’Œä»–ä»¬åšä¸€äº›äº¤äº’çš„æ—¶å€™ï¼ˆä¾‹å¦‚è·å–æ¯ä¸ªä¸šåŠ¡çš„å¾…åŠæ•°ç›®ï¼Œå±•ç¤ºåœ¨é¦–é¡µå›¾æ ‡çš„è§’æ ‡ä¸Šï¼‰ï¼Œæ‰‹æœºç«¯å¼€å‘è€…å°±å¾ˆå¤´ç–¼äº†ã€‚</p>
<p>â€‹    å°±ä»¥å¾…åŠæ•°ç›®ä¸ºä¾‹ï¼Œæ¥å£ä¸ç»Ÿä¸€ã€å‚æ•°ä¸ç»Ÿä¸€ã€å“åº”é€Ÿåº¦ä¸ç»Ÿä¸€ã€éšæ—¶æ¥å…¥æ–°çš„ç³»ç»Ÿï¼Œäº¤äº’è¿‡ç¨‹å¦‚æœå†™åœ¨ App ä¸­ï¼Œé‚£å°±éœ€è¦é¢‘ç¹çš„æ›´æ–° Appï¼Œè¿™å¯¹ç”¨æˆ·æ¥è¯´ï¼Œæ˜¯éå¸¸ä¸å‹å¥½çš„ã€‚è¿™ä¸ªæ—¶å€™é€šå¸¸éµå¾ªçš„ä¸€ä¸ªåŸåˆ™å°±æ˜¯ï¼Œå°†å˜åŒ–æ”¾åœ¨ OA-Serverï¼ŒOA-App åªéœ€è¦ä¸ OA-Server çº¦å®šå¥½æ¥å£è§„èŒƒï¼Œåªè®¿é—®è‡ªå·±çš„åå°å³å¯ï¼Œä¸å„ä¸ªä¸šåŠ¡çš„äº¤äº’äº¤ç»™åå°ã€‚é‚£ OA-App å‘é€è¯·æ±‚åˆ°  OA-Serverï¼ŒOA-Server æ”¶åˆ°å¤šä¸ªä¸šåŠ¡å“åº”çš„å¾…åŠæ•°ç›®ä»¥åæ€ä¹ˆåŠæ—¶çš„é€šçŸ¥ OA-App å‘¢ï¼Ÿ</p>
<a id="more"></a>

<p>â€‹    æåˆ°æœåŠ¡ç«¯æ•°æ®æ¨é€ï¼Œå¯èƒ½ä¸€ä¸‹å­å®¹æ˜“æƒ³åˆ° WebSocketã€‚WebSocket æ˜¯ä¸€ç§å…¨æ–°çš„åè®®ï¼Œéšç€ HTML5 è‰æ¡ˆçš„ä¸æ–­å®Œå–„ï¼Œè¶Šæ¥è¶Šå¤šçš„ç°ä»£æµè§ˆå™¨å¼€å§‹å…¨é¢æ”¯æŒ WebSocket æŠ€æœ¯äº†ï¼Œå®ƒå°† TCP çš„ Socketï¼ˆå¥—æ¥å­—ï¼‰åº”ç”¨åœ¨äº†web page ä¸Šï¼Œä»è€Œä½¿é€šä¿¡åŒæ–¹å»ºç«‹èµ·ä¸€ä¸ªä¿æŒåœ¨æ´»åŠ¨çŠ¶æ€è¿æ¥é€šé“ã€‚å®ƒæ˜¯ä¸€ç§å…¨åŒå·¥é€šä¿¡ï¼Œè€Œæˆ‘ä»¬å‰é¢æåˆ°çš„è·å–å¾…åŠæ•°ç›®çš„åœºæ™¯ï¼ŒApp å‘é€ä¸€æ¬¡è¯·æ±‚å°±å¯ä»¥ï¼Œserver æ‹¿åˆ°å„ä¸ªä¸šåŠ¡çš„æ•°æ®åå†åˆ†åˆ«å®æ—¶è¿”å›ç»™ App ï¼Œæ›´åƒæ˜¯ä¸€ç§å•å‘é€šä¿¡ï¼Œä½¿ç”¨ WebSocket å²‚ä¸æ˜¯æ€é¸¡ç”¨ç‰›åˆ€ï¼Ÿé‚£è½®è¯¢å‘¢ï¼Ÿè€—è´¹ server èµ„æºä¸è¯´ï¼Œä¸ä¸€å®šè¾¾åˆ°å®æ—¶çš„æ•ˆæœã€‚(PSï¼šè¿™é‡Œåæ§½ä¸‹å®¢æˆ·ï¼Œå¾…åŠæ•°æœ‰çš„ 999 å¤šï¼Œä¹Ÿä¸å¤„ç†ï¼Œå±…ç„¶åªä¼šå«Œå¼ƒæˆ‘ä»¬æ•°æ®è·å–çš„ä¸åŠæ—¶ğŸ¤“)â€¦â€¦</p>
<p>â€‹    å¥½å·§ä¸å·§ï¼Œçœ‹åˆ°äº†å¦ä¸€ä¸ªè½»é‡çº§çš„æ–¹æ¡ˆï¼šServer-Sent Eventsã€‚</p>
<h3 id="Server-Sent-Events"><a href="#Server-Sent-Events" class="headerlink" title="Server-Sent Events"></a>Server-Sent Events</h3><p>HTML5 ä¸­æœ‰ä¸€ä¸ªè½»é‡çš„æ›¿ä»£ WebSocketçš„æ–¹æ¡ˆï¼šServer-Sent Eventsï¼Œä»¥ä¸‹ç®€ç§° SSEã€‚</p>
<h4 id="SSE-æœ¬è´¨"><a href="#SSE-æœ¬è´¨" class="headerlink" title="SSE æœ¬è´¨"></a>SSE æœ¬è´¨</h4><p>â€‹    ä¸¥æ ¼åœ°è¯´ï¼ŒHTTP åè®®æ— æ³•åšåˆ°æœåŠ¡å™¨ä¸»åŠ¨æ¨é€ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ç§å˜é€šæ–¹æ³•ï¼Œå°±æ˜¯æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å£°æ˜ï¼Œæ¥ä¸‹æ¥è¦å‘é€çš„æ˜¯æµä¿¡æ¯ï¼ˆstreamingï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‘é€çš„ä¸æ˜¯ä¸€æ¬¡æ€§çš„æ•°æ®åŒ…ï¼Œè€Œæ˜¯ä¸€ä¸ªæ•°æ®æµï¼Œä¼šè¿ç»­ä¸æ–­åœ°å‘é€è¿‡æ¥ã€‚è¿™æ—¶ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå…³é—­è¿æ¥ï¼Œä¼šä¸€ç›´ç­‰ç€æœåŠ¡å™¨å‘è¿‡æ¥çš„æ–°çš„æ•°æ®æµï¼Œè§†é¢‘æ’­æ”¾å°±æ˜¯è¿™æ ·çš„ä¾‹å­ã€‚æœ¬è´¨ä¸Šï¼Œè¿™ç§é€šä¿¡å°±æ˜¯ä»¥æµä¿¡æ¯çš„æ–¹å¼ï¼Œå®Œæˆä¸€æ¬¡ç”¨æ—¶å¾ˆé•¿çš„ä¸‹è½½ã€‚SSE å°±æ˜¯åˆ©ç”¨è¿™ç§æœºåˆ¶ï¼Œä½¿ç”¨æµä¿¡æ¯å‘æµè§ˆå™¨æ¨é€ä¿¡æ¯ã€‚</p>
<h4 id="SSE-ç‰¹ç‚¹"><a href="#SSE-ç‰¹ç‚¹" class="headerlink" title="SSE ç‰¹ç‚¹"></a>SSE ç‰¹ç‚¹</h4><p><img src="/2021/02/19/Server-Sent%20Events/SSE.jpg" alt></p>
<p>WebSocket å’Œ SSE éƒ½æ˜¯ä¼ ç»Ÿè¯·æ±‚-å“åº” Web æ¶æ„çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä½†å®ƒä»¬ä¸æ˜¯å®Œå…¨å†²çªçš„æŠ€æœ¯ã€‚</p>
<ul>
<li>SSE ä½¿ç”¨ HTTP åè®®ï¼Œç°æœ‰çš„æœåŠ¡å™¨è½¯ä»¶éƒ½æ”¯æŒã€‚WebSocket æ˜¯ä¸€ä¸ªç‹¬ç«‹åè®®ã€‚</li>
<li>SSE å±äºè½»é‡çº§ï¼Œä½¿ç”¨ç®€å•ï¼›WebSocket åè®®ç›¸å¯¹å¤æ‚ã€‚</li>
<li>SSE é»˜è®¤æ”¯æŒæ–­çº¿é‡è¿ï¼ŒWebSocket éœ€è¦è‡ªå·±å®ç°ã€‚</li>
<li>SSE ä¸€èˆ¬åªç”¨æ¥ä¼ é€æ–‡æœ¬ï¼ŒäºŒè¿›åˆ¶æ•°æ®éœ€è¦ç¼–ç åä¼ é€ï¼ŒWebSocket é»˜è®¤æ”¯æŒä¼ é€äºŒè¿›åˆ¶æ•°æ®ã€‚</li>
<li>SSE æ”¯æŒè‡ªå®šä¹‰å‘é€çš„æ¶ˆæ¯ç±»å‹ã€‚</li>
</ul>
<p>æ˜¾ç„¶ï¼Œæˆ‘ä»¬ä¸Šé¢æåˆ°çš„ å¾…åŠæ•°ç›® åœºæ™¯ï¼Œå¾ˆé€‚åˆä½¿ç”¨ SSEã€‚</p>
<h3 id="EventSource"><a href="#EventSource" class="headerlink" title="EventSource"></a>EventSource</h3><p>EventSource æ˜¯ SSE å¯¹åº”çš„å®¢æˆ·ç«¯ APIï¼Œå¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½æ˜¯é»˜è®¤æ”¯æŒçš„ã€‚ç½‘ä¸Šçš„å¾ˆå¤šèµ„æ–™ä¹Ÿéƒ½æ˜¯ä»æµè§ˆå™¨çš„è§’åº¦æ¥è®²çš„ã€‚é‚£è¿™é‡Œæˆ‘ä»¬å°±ä» HTTP åè®®çš„è§’åº¦è®²ä¸€ä¸‹äº¤äº’è¿‡ç¨‹å§ã€‚ğŸ™„ï¼Œæ¯•ç«Ÿæˆ‘ä¸æ‡‚ web å‰ç«¯ã€‚</p>
<blockquote>
<p>API ä»‹ç»ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Server-sent_events/EventSource" target="_blank" rel="noopener"><strong>EventSource</strong></a></p>
</blockquote>
<h4 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h4><ul>
<li>é¦–å…ˆ Client å‘é€ä¸€ä¸ªæ™®æ™®é€šé€šçš„ GET è¯·æ±‚åˆ° SSE-Serverã€‚</li>
<li>SSE-Server æ— è®ºéœ€è¦è¿”å›å‡ æ¬¡æ•°æ®ï¼Œæ•°æ®æ ¼å¼å¿…é¡»æ˜¯ UTF-8 ç¼–ç çš„æ–‡æœ¬ï¼ŒHTTP å¤´éƒ¨ä¿¡æ¯éœ€è¦ç±»ä¼¼å¦‚ä¸‹è®¾ç½®ï¼š</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Type</span>: text/event-stream</span><br><span class="line"><span class="attribute">Cache-Control</span>: no-cache</span><br><span class="line"><span class="attribute">Connection</span>: keep-alive</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä¸‰è¡Œä¹‹ä¸­ï¼Œç¬¬ä¸€è¡Œçš„ <code>Content-Type</code> å¿…é¡»æŒ‡å®š MIME ç±»å‹ä¸º <code>event-steam</code> ã€‚</p>
<ul>
<li>SSE-Server æ¯ä¸€æ¬¡å‘é€çš„ä¿¡æ¯ï¼Œç”±è‹¥å¹²ä¸ª <code>message</code>ç»„æˆï¼Œæ¯ä¸ª <code>message</code> ä¹‹é—´ç”¨ <code>\n\n</code> åˆ†éš”ã€‚æ¯ä¸ª <code>message</code> å†…éƒ¨ç”±è‹¥å¹²è¡Œç»„æˆï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯å¦‚ä¸‹æ ¼å¼ï¼š</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[field]: value\n</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ <code>field</code> å¯ä»¥å–å››ä¸ªå€¼ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data</span><br><span class="line">event</span><br><span class="line">id</span><br><span class="line">retry</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥æœ‰å†’å·å¼€å¤´çš„è¡Œï¼Œè¡¨ç¤ºæ³¨é‡Šã€‚é€šå¸¸ï¼ŒæœåŠ¡å™¨æ¯éš”ä¸€æ®µæ—¶é—´å°±ä¼šå‘æµè§ˆå™¨å‘é€ä¸€ä¸ªæ³¨é‡Šï¼Œä¿æŒè¿æ¥ä¸ä¸­æ–­ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">: This is a comment</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">: this is a test stream\n\n</span><br><span class="line"></span><br><span class="line">data: some text\n\n</span><br><span class="line"></span><br><span class="line">data: another message\n</span><br><span class="line">data: with two lines \n\n</span><br></pre></td></tr></table></figure>

<ul>
<li>Client æ‹¿åˆ° message ä»¥åè‡ªå·±è§£æã€‚</li>
</ul>
<h4 id="message"><a href="#message" class="headerlink" title="message"></a>message</h4><p>å‰é¢æåˆ°çš„  <code>field</code>  æœ‰å››ä¸ªå€¼ï¼Œå¯ä»¥åˆ†åˆ«ç”¨ä½œä¸åŒçš„ç”¨é€”ã€‚</p>
<h5 id="data-æ•°æ®å†…å®¹"><a href="#data-æ•°æ®å†…å®¹" class="headerlink" title="data æ•°æ®å†…å®¹"></a>data æ•°æ®å†…å®¹</h5><p>å¦‚æœæ•°æ®å¾ˆé•¿ï¼Œå¯ä»¥åˆ†æˆå¤šè¡Œï¼Œæœ€åä¸€è¡Œç”¨ <code>\n\n</code> ç»“å°¾ï¼Œå‰é¢è¡Œéƒ½ç”¨ <code>\n</code> ç»“å°¾ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">data:  message\n\n</span><br><span class="line"></span><br><span class="line">data: begin message\n</span><br><span class="line">data: continue message\n\n</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘é€json</span></span><br><span class="line">data: &#123;\n</span><br><span class="line">data: "foo": "bar",\n</span><br><span class="line">data: "baz", 555\n</span><br><span class="line">data: &#125;\n\n</span><br></pre></td></tr></table></figure>

<h5 id="id-æ•°æ®æ ‡è¯†"><a href="#id-æ•°æ®æ ‡è¯†" class="headerlink" title="id æ•°æ®æ ‡è¯†"></a>id æ•°æ®æ ‡è¯†</h5><p>ç›¸å½“äºæ¯æ¡æ•°æ®çš„ç¼–å·ã€‚</p>
<p>æµè§ˆå™¨ç”¨ <code>lastEventId</code> å±æ€§è¯»å–è¿™ä¸ªå€¼ã€‚ä¸€æ—¦è¿æ¥æ–­çº¿ï¼Œæµè§ˆå™¨ä¼šå‘é€ä¸€ä¸ª HTTP å¤´ï¼Œé‡Œé¢åŒ…å«ä¸€ä¸ªç‰¹æ®Šçš„ <code>Last-Event-ID</code> å¤´ä¿¡æ¯ï¼Œå°†è¿™ä¸ªå€¼å‘é€å›å»ï¼Œç”¨æ¥å¸®åŠ©æœåŠ¡å™¨ç«¯é‡å»ºè¿æ¥ã€‚å› æ­¤ï¼Œè¿™ä¸ªå¤´ä¿¡æ¯å¯ä»¥è¢«è§†ä¸ºä¸€ç§åŒæ­¥æœºåˆ¶ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id: msg1\n</span><br><span class="line">data: message\n\n</span><br></pre></td></tr></table></figure>

<h5 id="event-è‡ªå®šä¹‰çš„äº‹ä»¶ç±»å‹"><a href="#event-è‡ªå®šä¹‰çš„äº‹ä»¶ç±»å‹" class="headerlink" title="event è‡ªå®šä¹‰çš„äº‹ä»¶ç±»å‹"></a>event è‡ªå®šä¹‰çš„äº‹ä»¶ç±»å‹</h5><p>é»˜è®¤æ˜¯<code>message</code>äº‹ä»¶ã€‚æµè§ˆå™¨å¯ä»¥ç”¨<code>addEventListener()</code>ç›‘å¬è¯¥äº‹ä»¶ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">event: foo\n</span><br><span class="line">data: a foo event\n\n</span><br><span class="line"></span><br><span class="line">data: an unnamed event\n\n</span><br><span class="line"></span><br><span class="line">event: bar\n</span><br><span class="line">data: a bar event\n\n</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç åˆ›é€ äº†ä¸‰æ¡ä¿¡æ¯ã€‚ç¬¬ä¸€æ¡çš„åå­—æ˜¯ <code>foo</code> ï¼Œè§¦å‘æµè§ˆå™¨çš„ <code>foo</code> äº‹ä»¶ï¼›ç¬¬äºŒæ¡æœªå–åï¼Œè¡¨ç¤ºé»˜è®¤ç±»å‹ï¼Œè§¦å‘æµè§ˆå™¨çš„ <code>message</code> äº‹ä»¶ï¼›ç¬¬ä¸‰æ¡æ˜¯ <code>bar</code> ï¼Œè§¦å‘æµè§ˆå™¨çš„ <code>bar</code> äº‹ä»¶ã€‚</p>
<p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">event: userconnect</span><br><span class="line">data: &#123;"username": "bobby", "time": "02:33:48"&#125;</span><br><span class="line"></span><br><span class="line">event: usermessage</span><br><span class="line">data: &#123;"username": "bobby", "time": "02:34:11", "text": "Hi everyone."&#125;</span><br><span class="line"></span><br><span class="line">event: userdisconnect</span><br><span class="line">data: &#123;"username": "bobby", "time": "02:34:23"&#125;</span><br><span class="line"></span><br><span class="line">event: usermessage</span><br><span class="line">data: &#123;"username": "sean", "time": "02:34:36", "text": "Bye, bobby."&#125;</span><br></pre></td></tr></table></figure>

<h5 id="retry-é‡è¿é—´éš”"><a href="#retry-é‡è¿é—´éš”" class="headerlink" title="retry é‡è¿é—´éš”"></a>retry é‡è¿é—´éš”</h5><p>æœåŠ¡å™¨å¯ä»¥ç”¨ <code>retry</code> å­—æ®µï¼ŒæŒ‡å®šæµè§ˆå™¨é‡æ–°å‘èµ·è¿æ¥çš„æ—¶é—´é—´éš”ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">retry: 10000\n</span><br></pre></td></tr></table></figure>

<p>ä¸¤ç§æƒ…å†µä¼šå¯¼è‡´æµè§ˆå™¨é‡æ–°å‘èµ·è¿æ¥ï¼šä¸€ç§æ˜¯æ—¶é—´é—´éš”åˆ°æœŸï¼ŒäºŒæ˜¯ç”±äºç½‘ç»œé”™è¯¯ç­‰åŸå› ï¼Œå¯¼è‡´è¿æ¥å‡ºé”™ã€‚</p>
<h3 id="iOS-å®ç°"><a href="#iOS-å®ç°" class="headerlink" title="iOS å®ç°"></a>iOS å®ç°</h3><p>ä»ä¸Šé¢çš„å†…å®¹æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæ—¢ç„¶ EventSource å®¢æˆ·ç«¯ä¸ server å»ºç«‹è¿æ¥æ˜¯åŸºäºæ ‡å‡†çš„ HTTP åè®®ï¼Œé‚£æˆ‘ä»¬æƒ³è¦å®ç°ä¸€å¥—è‡ªå·±çš„ EventSource API ï¼Œåªéœ€è¦æŒ‰è§„åˆ™è§£æ message å³å¯ã€‚</p>
<p>å¤§è‡´çš„æ€è·¯ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>NSURLSession</code> æ¥å‘èµ·è¯·æ±‚ä»¥åŠå¤„ç†æœåŠ¡å™¨çš„å“åº”ã€‚</li>
<li>åœ¨ <code>NSURLSession</code>  çš„ä»£ç†æ–¹æ³•ä¸­è§£æå¾—åˆ°çš„æ–‡æœ¬ä¿¡æ¯ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„ <code>Event</code> å¯¹è±¡æ¥æ”¶ã€‚</li>
<li>é€šè¿‡å›è°ƒå°† <code>Event</code> ä¼ é€’ç»™è°ƒç”¨è€…ã€‚</li>
</ul>
<p>ä»£ç æ˜¯åœ¨ä¸‹é¢è¿™ä»½ä¸Šåšçš„æ”¹åŠ¨ï¼Œæ·»åŠ äº†ä¸€äº›çº¿ç¨‹å®‰å…¨çš„å¤„ç†ï¼Œä»¥åŠ session çš„é‡Šæ”¾ï¼Œä¸ç„¶ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</p>
<blockquote>
<p>å¼•ç”¨çš„OCä»£ç  <a href="https://github.com/neilco/EventSource" target="_blank" rel="noopener">Github</a></p>
</blockquote>
<p>æ”¹åŠ¨åçš„æºç ï¼š<a href="https://github.com/ATommyGirl/YYEventSource" target="_blank" rel="noopener">ATommyGirl/YYEventSource</a></p>
<h3 id="æ¨¡æ‹Ÿæµ‹è¯•"><a href="#æ¨¡æ‹Ÿæµ‹è¯•" class="headerlink" title="æ¨¡æ‹Ÿæµ‹è¯•"></a>æ¨¡æ‹Ÿæµ‹è¯•</h3><p>å¯åŠ¨æœåŠ¡</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node sse-server.js</span><br></pre></td></tr></table></figure>

<p>ä¼šåœ¨æœ¬æœº <code>http://127.0.0.1:8844/stream</code> å¯åŠ¨ä¸€ä¸ª SSE æœåŠ¡ã€‚</p>
<p>ä½¿ç”¨æµè§ˆå™¨æˆ–è€… OC ä»£ç è®¿é—®è¿™ä¸ªåœ°å€å°±ä¼šçœ‹åˆ°ä¿¡æ¯è¾“å‡ºäº†ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"EventSource.h"</span></span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *url = <span class="string">@"http://127.0.0.1:8844/stream"</span>;</span><br><span class="line">EventSource *eventSource = [EventSource eventSourceWithURL:[<span class="built_in">NSURL</span> URLWithString:url]];</span><br><span class="line"></span><br><span class="line">[eventSource onMessage:^(Event *e) &#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, e);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[eventSource onError:^(Event *event) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"error:%@"</span>, event.error);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>



<h3 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h3><p><a href="https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html" target="_blank" rel="noopener">é˜®ä¸€å³°</a></p>

                                                                        
                                    </div>
                                    <footer class="article-footer">
                                        <a data-url="https://atommygirl.github.io/2021/02/19/Server-Sent%20Events/" data-id="ckq7x9zf1000h0cku2uzd55sj" class="article-share-link">
                                            åˆ†äº«
                                        </a>
                                        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li></ul>

                                    </footer>

    </div>

    
        
  <nav class="article-nav">
    
      <a href="/2021/04/15/%E6%98%A8%E5%A4%A9/" class="article-nav-link">
        <strong class="article-nav-caption">å‰ä¸€ç¯‡</strong>
        <div class="article-nav-title">
          
            æ˜¨å¤©
          
        </div>
      </a>
    
    
      <a href="/2021/02/07/UIDocumentInteractionController/" class="article-nav-link">
        <strong class="article-nav-caption">åä¸€ç¯‡</strong>
        <div class="article-nav-title">UIDocumentInteractionController</div>
      </a>
    
  </nav>


            

                
                    
                        
  <div class="gitalk" id="gitalk-container"></div>
  
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

  
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

  
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>

  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: 'c0fd3fecc668416852dc',
      clientSecret: '5f849bbb22f9233b3fe19627c9eb28be39b721d1',
      repo: 'YYBlogGitTalk',
      owner: 'ATommyGirl',
      admin: ['ATommyGirl'],
      // id: location.pathname,      // Ensure uniqueness and length less than 50
      id: md5(location.pathname),
      distractionFreeMode: false,  // Facebook-like distraction free mode
      pagerDirection: 'last'
    })

  gitalk.render('gitalk-container')
  </script>

                            

</article>
</section>
  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
    <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2021 è¿·</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean" target="_blank" rel="noopener">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>
<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/myicon.jpg" alt="è¿·"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">Home</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">Archives</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">Gallery</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">About</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="æœç´¢">
        <i class="fe fe-search"></i>
        æœç´¢
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>

<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




  
<script src="/js/tocbot.min.js"></script>

  <script>
    // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
    tocbot.init({
      tocSelector: '.tocbot',
      contentSelector: '.article-entry',
      headingSelector: 'h1, h2, h3, h4, h5, h6',
      hasInnerContainers: true,
      scrollSmooth: true,
      positionFixedSelector: '.tocbot',
      positionFixedClass: 'is-position-fixed',
      fixedSidebarOffset: 'auto',
    });
  </script>



<script src="/js/ocean.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":300,"height":600,"vOffset":-100,"hOffset":-50},"mobile":{"show":true},"log":false});</script></body>
</html>